webpackJsonp([20],{LRY7:function(e,t){},WHQY:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=o("mvHQ"),a=o.n(l),r=o("BO1k"),n=o.n(r),s=(o("0RrJ"),{name:"StaffManage",data:function(){var e=this,t=/^[a-zA-Z][a-zA-Z0-9_]{6,10}$/,o=/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,16}$/,l=/^1[3578]\d{9}$/,a=/^[\u4E00-\u9FA5A-Za-z0-9_]{1,6}$/;return{url:"http://127.0.0.1/th5/public/admin_staff/staff/",rules:{name:[{validator:function(e,t,o){""===t||void 0==t?o(new Error("请创建昵称")):(null==t.match(a)&&o(new Error("昵称规则：1-6位中文、英文、数字包括下划线")),o())},trigger:"blur"}],account:[{validator:function(e,o,l){if(!o)return l(new Error("账号不可为空"));setTimeout(function(){null==o.match(t)?l(new Error("账号规则：6-10位英文+数字，英文开头")):l()},1e3)},trigger:"blur"}],password:[{validator:function(e,t,l){""===t||void 0==t?l(new Error("请输入密码")):(null==t.match(o)&&l(new Error("密码规则：8-10位英文+数字,必须包含大小写字母和数字")),l())},trigger:"blur"}],phone:[{validator:function(e,t,o){if(void 0!=t){var a=t.toString();a?(null==a.match(l)&&o(new Error("手机号规则：13,15,17,18开头，11位数字")),o()):o(new Error("请输入手机号"))}else o(new Error("请输入手机号"))},trigger:"blur"}],checkRole:[{validator:function(t,o,l){""===e.form.checkRole||void 0==o?l(new Error("请选择职位")):l()},trigger:"blur"}],sex:[{validator:function(e,t,o){""===t||void 0==t?o(new Error("请选择性别")):o()},trigger:"blur"}]},dialogTitle:"",selectInfo:"",selectVal:"",roleArr:[],staffArr:[],checkArr:[],selectRow:[],addDialogForm:!1,editDialogForm:!1,form:{name:"",account:"",password:"",phone:"",head_img:"https://dss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1091405991,859863778&fm=26&gp=0.jpg",role_name:"",checkRole:"",sex:"男",delivery:!1},formLabelWidth:"120px",options:[{value:"1",label:"账号"},{value:"2",label:"昵称"},{value:"3",label:"手机号"},{value:"4",label:"职位"}],nowPage:1,pageSize:5}},mounted:function(){this.loadBack(),this.getStaff(this.nowPage,"","")},methods:{getSearchInfo:function(e){e||this.getStaff(this.nowPage,this.selectVal,this.selectInfo)},handleSelectionChange:function(e){var t;this.selectRow=[];var o=[],l=!0,a=!1,r=void 0;try{for(var s,i=n()(e);!(l=(s=i.next()).done);l=!0){var c=s.value;o.push(c.id)}}catch(e){a=!0,r=e}finally{try{!l&&i.return&&i.return()}finally{if(a)throw r}}(t=this.selectRow).push.apply(t,o)},handleCurrentChange:function(e){this.nowPage=e},handleSizeChange:function(e){this.pageSize=e},getStaff:function(e){var t=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.nowPage=1,localStorage.getItem("staffAcc")){var a=localStorage.getItem("staffAcc");this.staffArr=[],this.$post(this.url+"getStaffArr",{type:o,keyWord:l,acc:a}).then(function(e){e.data?(t.total=e.data.length,t.staffArr=e.data):t.total=0}).catch(function(e){console.log(e)})}else console.log(1)},addStaff:function(e){var t=this;this.$refs.MyForm.validate(function(o){if(!o)return!1;t.loadBack(),t.$post(t.url+"addStaff",{data:e}).then(function(e){var o="";1==e.code?(o="success",t.form={},t.addDialogForm=!1):o="error",t.$message({showClose:!0,message:e.msg,type:o}),t.getStaff(t.nowPage)}).catch(function(e){console.log(e)})})},enterEdit:function(e){var t=this;this.$refs.MyForm.validate(function(o){if(!o)return!1;t.loadBack(),t.$post(t.url+"editStaff",{data:e}).then(function(e){var o="";1==e.code?(o="success",t.editDialogForm=!1,t.form={}):0==e.code?(o="error",t.editDialogForm=!1,t.form={}):o="error",t.$message({showClose:!0,message:e.msg,type:o}),t.getStaff(t.nowPage)}).catch(function(e){console.log(e)})})},getRoleArr:function(){var e=this;e.$post(e.url+"getRoleArr",{}).then(function(t){e.roleArr=t.data}).catch(function(e){console.log(e)})},editState:function(e,t){var o=this;this.loadBack(),1==t.state?t.state=0:t.state=1;var l=this;l.$post(l.url+"editState",{id:t.id,state:t.state}).then(function(e){var t="";t=1==e.code&&1==e.data?"success":"error",l.$message({showClose:!0,message:e.msg,type:t}),l.getStaff(o.nowPage)}).catch(function(e){console.log(e)})},loadBack:function(){var e=this.$loading({lock:!0,text:"拼命加载中",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});setTimeout(function(){e.close()},2e3)},editStaff:function(e){this.form=e,this.dialogTitle="修改员工信息",this.editDialogForm=!0},delStaff:function(e){var t=this;this.$post(this.url+"delStaff",{data:e}).then(function(e){var o=1==e.code?"success":"error";t.$message({showClose:!0,message:e.msg,type:o}),t.getStaff(1)}).catch(function(e){console.log(e)})},batchDeleteStaff:function(){var e=this;if(this.selectRow.length>0){var t=a()(this.selectRow);this.$fetch(this.url+"batchDeleteStaff",{delArr:t}).then(function(t){var o=1==t.code?"success":"error";e.$message({showClose:!0,message:t.msg,type:o}),e.getStaff(1)}).catch(function(e){console.log(e)})}else this.$message({showClose:!0,message:"请先选择删除项",type:"error"})},resetPsw:function(e){var t=this;this.loadBack(),this.$fetch(this.url+"resetPsw",{data:e}).then(function(e){var o=1==e.code?"success":"error",l="";l=e.data?e.msg+",初始密码为："+e.data:e.msg,t.$message({showClose:!0,message:l,type:o})}).catch(function(e){console.log(e)})},closeFun:function(e){this.form={},this.$refs.MyForm.resetFields()},clearSearch:function(){this.selectVal="",this.selectInfo="",this.getStaff()}}}),i={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"contanir"}},[o("el-breadcrumb",{staticStyle:{"font-size":"20px"},attrs:{"separator-class":"el-icon-arrow-right"}},[o("el-breadcrumb-item",[e._v("Peanut后台")]),e._v(" "),o("el-breadcrumb-item",[e._v("员工管理")])],1),e._v(" "),o("el-row",{staticClass:"row-bg",attrs:{type:"flex",push:"3"}},[o("el-col",{attrs:{span:3}},[o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addDialogForm=!0,e.dialogTitle="添加员工信息"}}},[e._v("添加员工")])],1),e._v(" "),o("el-col",{attrs:{span:3}},[o("el-popconfirm",{attrs:{title:"是否批量操作？删除后不可恢复"},on:{onConfirm:e.batchDeleteStaff}},[o("el-button",{attrs:{slot:"reference",type:"danger"},slot:"reference"},[e._v("批量删除")])],1)],1),e._v(" "),o("el-col",{attrs:{span:12}},[o("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"请选择"},model:{value:e.selectVal,callback:function(t){e.selectVal=t},expression:"selectVal"}},e._l(e.options,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),e._v(" "),o("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容，默认为账号",onkeyup:"value=value.replace(/[^\\w\\u4E00-\\u9FA5_]/g, '')"},on:{blur:function(t){return e.getSearchInfo(e.selectInfo)}},model:{value:e.selectInfo,callback:function(t){e.selectInfo=t},expression:"selectInfo"}}),e._v(" "),o("el-button",{attrs:{icon:"el-icon-search"},on:{click:function(t){return e.getStaff(e.nowPage,e.selectVal,e.selectInfo)}}})],1),e._v(" "),o("el-col",{attrs:{span:3}},[""!=e.selectInfo||""!=e.selectVal?o("el-button",{attrs:{type:"primary"},on:{click:e.clearSearch}},[e._v("清空搜索")]):e._e()],1)],1),e._v(" "),o("el-dialog",{attrs:{title:e.dialogTitle,center:"",visible:e.addDialogForm},on:{close:e.closeFun,"update:visible":function(t){e.addDialogForm=t}}},[o("el-form",{ref:"MyForm",staticClass:"demo-ruleForm",attrs:{model:e.form,"status-icon":"",rules:e.rules}},[o("el-form-item",{attrs:{label:"员工账号",prop:"account","label-width":e.formLabelWidth}},[o("el-input",{attrs:{onKeyUp:"value=value.replace(/[\\W]/g,'')",required:"true",placeholder:"6-10位英文+数字，英文开头"},model:{value:e.form.account,callback:function(t){e.$set(e.form,"account",t)},expression:"form.account"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"员工密码",prop:"password","label-width":e.formLabelWidth}},[o("el-input",{attrs:{placeholder:"8-10位数字+大小写字母",onKeyUp:"value=value.replace(/[\\W]/g,'')","show-password":""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"昵称",prop:"name","label-width":e.formLabelWidth}},[o("el-input",{attrs:{onkeyup:"value=value.replace(/[^\\w\\u4E00-\\u9FA5_]/g, '')",placeholder:"1~6位中文、英文、数字包括下划线"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"手机号",prop:"phone","label-width":e.formLabelWidth}},[o("el-input",{attrs:{type:"text",placeholder:"13,15,17,18开头，11位数字",onkeyup:"this.value=this.value.replace(/\\D/g,'')",maxlength:"11","show-word-limit":""},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"员工职位",prop:"checkRole","label-width":e.formLabelWidth}},[o("el-select",{attrs:{placeholder:"请选择员工职位"},on:{focus:e.getRoleArr},model:{value:e.form.checkRole,callback:function(t){e.$set(e.form,"checkRole",t)},expression:"form.checkRole"}},[e._l(e.roleArr,function(e,t){return["超级管理员"==e.role_name?o("el-option",{key:t,attrs:{disabled:"",value:e.role_name}}):o("el-option",{key:t,attrs:{label:e.role_name,value:e.role_name}})]})],2)],1),e._v(" "),o("el-form-item",{attrs:{label:"性别",prop:"sex","label-width":e.formLabelWidth}},[o("el-radio",{attrs:{label:"男"},model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}},[e._v("男")]),e._v(" "),o("el-radio",{attrs:{label:"女"},model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}},[e._v("女")])],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.addDialogForm=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary",plain:!0},on:{click:function(t){return e.addStaff(e.form)}}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:e.dialogTitle,center:"",visible:e.editDialogForm},on:{close:e.closeFun,"update:visible":function(t){e.editDialogForm=t}}},[o("el-form",{ref:"MyForm",staticClass:"demo-ruleForm",attrs:{model:e.form,"status-icon":"",rules:e.rules}},[o("el-form-item",[e.form.head_img?o("el-image",{staticClass:"avatar",attrs:{src:e.form.head_img}}):o("i",{staticClass:"el-icon-plus avatar-uploader-icon"})],1),e._v(" "),o("el-form-item",{attrs:{label:"员工账号",prop:"account","label-width":e.formLabelWidth}},[o("span",[e._v(e._s(e.form.account))])]),e._v(" "),o("el-form-item",{attrs:{label:"昵称",prop:"name","label-width":e.formLabelWidth}},[o("el-input",{attrs:{onkeyup:"value=value.replace(/[^\\w\\u4E00-\\u9FA5_]/g, '')",placeholder:"1~6位中文、英文、数字包括下划线"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"手机号",prop:"phone","label-width":e.formLabelWidth}},[o("el-input",{attrs:{type:"text",placeholder:"13,15,17,18开头，11位数字",onkeyup:"this.value=this.value.replace(/\\D/g,'')",maxlength:"11","show-word-limit":""},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"员工职位",prop:"role_name","label-width":e.formLabelWidth}},[o("el-select",{attrs:{placeholder:"请选择员工职位"},on:{focus:e.getRoleArr},model:{value:e.form.role_name,callback:function(t){e.$set(e.form,"role_name",t)},expression:"form.role_name"}},[e._l(e.roleArr,function(e,t){return["超级管理员"==e.role_name?o("el-option",{key:t,attrs:{disabled:"",value:e.role_name}}):o("el-option",{key:t,attrs:{label:e.role_name,value:e.role_name}})]})],2)],1),e._v(" "),o("el-form-item",{attrs:{label:"性别",prop:"sex","label-width":e.formLabelWidth}},[o("el-radio",{attrs:{label:"男"},model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}},[e._v("男")]),e._v(" "),o("el-radio",{attrs:{label:"女"},model:{value:e.form.sex,callback:function(t){e.$set(e.form,"sex",t)},expression:"form.sex"}},[e._v("女")])],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.addDialogForm=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary",plain:!0},on:{click:function(t){return e.enterEdit(e.form)}}},[e._v("确 定")])],1)],1),e._v(" "),o("el-table",{ref:"multipleTable",staticStyle:{width:"100%","border-radius":"10px"},attrs:{"header-cell-style":{background:"skyblue",color:"white",fontSize:"18px"},"highlight-current-row":"",border:"",data:e.staffArr.slice((e.nowPage-1)*e.pageSize,e.nowPage*e.pageSize),"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{align:"center",type:"selection"}}),e._v(" "),o("el-table-column",{attrs:{align:"center",prop:"id",sortable:"",label:"ID"}}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"账号"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(t.row.account))])]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"昵称"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(t.row.name))])]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"头像"},scopedSlots:e._u([{key:"default",fn:function(e){return[o("el-image",{staticStyle:{width:"80px","border-radius":"50%"},attrs:{src:e.row.head_img}})]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"手机号",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(t.row.phone))])]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"职位"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(t.row.role_name))])]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"性别"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(t.row.sex))])]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.state?o("span",[e._v("解锁")]):0==t.row.state?o("span",[e._v("锁定")]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"操作",width:"240px"},scopedSlots:e._u([{key:"default",fn:function(t){return"超级管理员"!=t.row.role_name?[1==t.row.state?o("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"点击锁定",placement:"top"}},[o("el-button",{attrs:{type:"warning",icon:"el-icon-lock",circle:""},on:{click:function(o){return e.editState(t.row.id,t.row)}}})],1):0==t.row.state?o("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"点击解锁",placement:"top"}},[o("el-button",{attrs:{type:"primary",icon:"el-icon-unlock",circle:""},on:{click:function(o){return e.editState(t.row.id,t.row)}}})],1):e._e(),e._v(" "),o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"点击修改当前员工信息",placement:"top"}},[o("el-button",{attrs:{type:"primary",icon:"el-icon-edit",circle:""},on:{click:function(o){return e.editStaff(t.row)}}})],1),e._v(" "),o("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"点击删除当前员工",placement:"top"}},[o("el-popconfirm",{attrs:{title:"确认删除该用户？",icon:"el-icon-info",iconColor:"red"},on:{onConfirm:function(o){return e.delStaff(t.row.id)}}},[o("el-button",{attrs:{slot:"reference",type:"danger",icon:"el-icon-delete",circle:""},slot:"reference"})],1)],1),e._v(" "),o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"点击重置密码",placement:"top"}},[o("el-popconfirm",{attrs:{title:"是否重置密码？"},on:{onConfirm:function(o){return e.resetPsw(t.row.id)}}},[o("el-button",{attrs:{slot:"reference",type:"danger",icon:"el-icon-refresh",circle:""},slot:"reference"})],1)],1)]:void 0}}],null,!0)})],1),e._v(" "),o("el-pagination",{staticStyle:{"text-align":"center"},attrs:{background:"","current-page":e.nowPage,"page-sizes":[5,10,15,100],"page-size":e.pageSize,layout:"total, prev, sizes ,pager, next, jumper",total:e.staffArr.length},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1)},staticRenderFns:[]};var c=o("VU/8")(s,i,!1,function(e){o("LRY7")},"data-v-4f4520e7",null);t.default=c.exports}});
//# sourceMappingURL=20.fef413117a7fa313b322.js.map