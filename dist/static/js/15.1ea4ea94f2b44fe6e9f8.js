webpackJsonp([15],{"0uMb":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("BO1k"),i=n.n(o),a=n("mvHQ"),s=n.n(a),c=n("9K/l"),r={name:"Chat",data:function(){return{adminInfo:{},inputMsg:"",taleList:[],socket:"",socketMsg:{},uid:"",tool:{show:["file","history","img"],callback:this.toolEvent},config:{img:"",name:"",dept:"聊天记录",callback:this.headerEvent}}},mounted:function(){this.getInfoData(),this.getchat()},created:function(){this.init()},methods:{getInfoData:function(){var t=this,e={token:JSON.parse(localStorage.getItem("token"))};Object(c.b)("/info/Center/get",e).then(function(e){if(1==e.data.code){var n=e.data.data;t.adminInfo=n[0]}}).catch(function(t){console.log(t)})},bindEnter:function(){var t=this.inputMsg;if(t){var e={date:(new Date).toLocaleDateString()+(new Date).toLocaleTimeString(),text:{text:t},mine:!0,name:"客服1号",img:"https://dss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1091405991,859863778&fm=26&gp=0.jpg"};this.taleList.push(e);var n={type:"infor",sender:"adminServer",receiver:this.uid,container:t,name:"客服1号",img:"https://dss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1091405991,859863778&fm=26&gp=0.jpg",mine:!1},o=s()(n);console.log(o),this.socket.send(o)}},toolEvent:function(t){console.log("tools",t)},headerEvent:function(t){console.log("header",t)},init:function(){"undefined"==typeof WebSocket?alert("您的浏览器不支持socket"):(this.socket=new WebSocket("ws://127.0.0.1:3000"),this.socket.onopen=this.open,this.socket.onerror=this.error,this.socket.onmessage=this.getMessage)},open:function(){console.log("socket连接成功"),this.send()},error:function(){console.log("连接错误")},getMessage:function(t){var e=JSON.parse(t.data);this.taleList.push(e.container),this.config.img=e.container.img,this.config.name=e.container.name,this.uid=e.id,console.log(e.id)},send:function(){var t=s()({type:"show",account:"adminServer"});console.log(t),this.socket.send(t)},close:function(){console.log("socket已经关闭")},destroyed:function(){this.socket.onclose=this.close},getchat:function(){var t=this;Object(c.a)("/info/Center/chat").then(function(e){if(1==e.data.code){console.log(e.data.data);var n=!0,o=!1,a=void 0;try{for(var s,c=i()(e.data.data);!(n=(s=c.next()).done);n=!0){var r=s.value;if("adminServer"==r.sender){var l={date:r.chat_time,text:{text:r.content},mine:!0,name:"客服1号",img:"https://dss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1091405991,859863778&fm=26&gp=0.jpg"};t.taleList.push(l)}else{var h={date:r.chat_time,text:{text:r.content},mine:!1,name:r.name,img:r.head_img};t.taleList.push(h)}}}catch(t){o=!0,a=t}finally{try{!n&&c.return&&c.return()}finally{if(o)throw a}}}}).catch(function(t){console.log(t)})}}},l={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("JwChat-index",{attrs:{config:t.config,taleList:t.taleList,toolConfig:t.tool,height:"480"},on:{enter:t.bindEnter},model:{value:t.inputMsg,callback:function(e){t.inputMsg=e},expression:"inputMsg"}})},staticRenderFns:[]};var h=n("VU/8")(r,l,!1,function(t){n("x7mM")},null,null);e.default=h.exports},x7mM:function(t,e){}});
//# sourceMappingURL=15.1ea4ea94f2b44fe6e9f8.js.map