{"version":3,"sources":["webpack:///src/components/admin/Chat.vue","webpack:///./src/components/admin/Chat.vue?e17f","webpack:///./src/components/admin/Chat.vue"],"names":["Chat","name","data","adminInfo","inputMsg","taleList","socket","socketMsg","uid","tool","show","callback","this","toolEvent","config","img","dept","headerEvent","mounted","getInfoData","getchat","created","init","methods","_this","token","JSON","parse","localStorage","getItem","Object","home","then","res","code","admin","catch","err","console","log","bindEnter","msg","msgObj","date","Date","toLocaleDateString","toLocaleTimeString","text","mine","push","sendContainer","type","sender","receiver","container","params","stringify_default","send","WebSocket","alert","onopen","open","onerror","error","onmessage","getMessage","msgChat","id","account","close","destroyed","onclose","_this2","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","get_iterator_default","next","done","item","value","chat_time","content","_msgObj","head_img","return","admin_Chat","render","_vm","_h","$createElement","_self","_c","attrs","toolConfig","height","on","enter","model","$$v","expression","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/15.1ea4ea94f2b44fe6e9f8.js","sourcesContent":["// 聊天组件\r\n<template>\r\n  <JwChat-index \r\n  :config=\"config\" \r\n  :taleList=\"taleList\" \r\n  @enter=\"bindEnter\" \r\n  v-model=\"inputMsg\" \r\n  :toolConfig=\"tool\"\r\n  height=\"480\"/>\r\n</template>\r\n<style>\r\n.web__tools dl{\r\n  margin-top: 20px;\r\n}\r\n</style>\r\n<script>\r\n// 引入网络请求模块\r\nimport { getData, sendParam } from \"../../network/home\";\r\nexport default {\r\n  name: \"Chat\",\r\n  data() {\r\n    return {\r\n      adminInfo: {},\r\n      inputMsg: \"\",\r\n      taleList: [],\r\n      socket: \"\",\r\n      socketMsg: {},\r\n      uid: '',\r\n      tool: {\r\n        show: [\"file\", \"history\", \"img\"],\r\n        callback: this.toolEvent\r\n      },\r\n      config: {\r\n        img: '',\r\n        name: '',\r\n        dept: \"聊天记录\",\r\n        callback: this.headerEvent\r\n      }\r\n    };\r\n  },\r\n  mounted() {\r\n    this.getInfoData()\r\n    this.getchat()\r\n  },\r\n  created() {\r\n     // 初始化websocket\r\n    this.init();\r\n  },\r\n  methods: {\r\n     // 获取员工信息\r\n    getInfoData() {\r\n      let url = \"/info/Center/get\";\r\n      let data = {\r\n        token: JSON.parse(localStorage.getItem(\"token\"))\r\n      };\r\n      sendParam(url, data)\r\n        .then(res => {\r\n          // console.log(res.data.data);\r\n          if (res.data.code == 1) {\r\n            let admin = res.data.data;\r\n            this.adminInfo = admin[0];\r\n\r\n            \r\n          } else {\r\n          }\r\n        })\r\n        .catch(err => {\r\n          console.log(err);\r\n        });\r\n    },\r\n    bindEnter() {\r\n      const msg = this.inputMsg;\r\n      if (!msg) return;\r\n      const msgObj = {\r\n        date: new Date().toLocaleDateString() + new Date().toLocaleTimeString(),\r\n        text: { text: msg },\r\n        mine: true,\r\n        name: \"客服1号\",\r\n        img: \"https://dss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1091405991,859863778&fm=26&gp=0.jpg\"\r\n      };\r\n      this.taleList.push(msgObj);\r\n      // 发送到nodee\r\n      var sendContainer = {\r\n        type: 'infor',\r\n        sender: 'adminServer',\r\n        receiver: this.uid,\r\n        container: msg,\r\n        name: \"客服1号\",\r\n        img: \"https://dss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1091405991,859863778&fm=26&gp=0.jpg\",\r\n        mine: false\r\n      }\r\n      let params = JSON.stringify(sendContainer);\r\n      console.log(params)\r\n      this.socket.send(params);\r\n    },\r\n    toolEvent(type) {\r\n      console.log(\"tools\", type);\r\n    },\r\n    headerEvent(type) {\r\n      console.log(\"header\", type);\r\n    },\r\n    //-------websocket--\r\n    init() {\r\n      if (typeof WebSocket === \"undefined\") {\r\n        alert(\"您的浏览器不支持socket\");\r\n      } else {\r\n        // 实例化socket\r\n        this.socket = new WebSocket(\"ws://127.0.0.1:3000\");\r\n        // 监听socket连接\r\n        this.socket.onopen = this.open;\r\n        // 监听socket错误信息\r\n        this.socket.onerror = this.error;\r\n        // 监听socket消息\r\n        this.socket.onmessage = this.getMessage;\r\n      }\r\n    },\r\n    open() {\r\n      console.log(\"socket连接成功\");\r\n      this.send()\r\n    },\r\n    error() {\r\n      console.log(\"连接错误\");\r\n    },\r\n    getMessage(msg) {\r\n      let msgChat = JSON.parse(msg.data);\r\n      // console.log(msgChat.container)\r\n      this.taleList.push(msgChat.container)\r\n      this.config.img = msgChat.container.img\r\n      this.config.name = msgChat.container.name\r\n      this.uid = msgChat.id\r\n      console.log(msgChat.id)\r\n    },\r\n    send() {\r\n      let showObj = {\r\n        type: \"show\",\r\n        account: 'adminServer'\r\n      };\r\n      let params = JSON.stringify(showObj);\r\n      console.log(params)\r\n      this.socket.send(params);\r\n    },\r\n    close() {\r\n      console.log(\"socket已经关闭\");\r\n    },\r\n    destroyed() {\r\n      // 销毁监听\r\n      this.socket.onclose = this.close;\r\n    },\r\n    getchat(){\r\n      let url = \"/info/Center/chat\";\r\n      getData(url)\r\n        .then(res => {\r\n          if (res.data.code == 1) {\r\n            console.log(res.data.data)\r\n            for( let item of res.data.data){\r\n              if(item.sender == 'adminServer'){\r\n                const msgObj = {\r\n                  date: item.chat_time,\r\n                  text: { text: item.content },\r\n                  mine: true,\r\n                  name: \"客服1号\",\r\n                  img: \"https://dss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1091405991,859863778&fm=26&gp=0.jpg\"\r\n                };\r\n                this.taleList.push(msgObj);\r\n              }else{\r\n                const msgObj = {\r\n                  date: item.chat_time,\r\n                  text: { text: item.content },\r\n                  mine: false,\r\n                  name: item.name,\r\n                  img: item.head_img\r\n                };\r\n                this.taleList.push(msgObj);\r\n              }\r\n            }\r\n            \r\n          \r\n          }\r\n        })\r\n        .catch(err => {\r\n          console.log(err);\r\n        });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\n\n\n// WEBPACK FOOTER //\n// src/components/admin/Chat.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('JwChat-index',{attrs:{\"config\":_vm.config,\"taleList\":_vm.taleList,\"toolConfig\":_vm.tool,\"height\":\"480\"},on:{\"enter\":_vm.bindEnter},model:{value:(_vm.inputMsg),callback:function ($$v) {_vm.inputMsg=$$v},expression:\"inputMsg\"}})}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-bca9a374\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/admin/Chat.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-bca9a374\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Chat.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Chat.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Chat.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-bca9a374\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./Chat.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/admin/Chat.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}