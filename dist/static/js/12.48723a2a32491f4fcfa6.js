webpackJsonp([12],{"4RN3":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("mvHQ"),a=i.n(n),r=i("//Fk"),l=i.n(r),o={name:"Jurisdic",data:function(){return{url:"http://localhost/th5/public/adminJurisdiction/Jurisdition/",tableData:[],menuData:[],allMenuArr:[],editJurDialog:!1,editJurData:[],editJurVal:[],nowRoleId:"",transferTitle:["所有权限","现有权限"],defaultProps:{children:"children",label:"label"},jurTitle:"",currentRow:"",selectIndex:""}},mounted:function(){this.getJurisditionList("权限列表")},methods:{getJurisditionList:function(t){var e=this;this.jurTitle=t,this.$fetch(this.url+"getRoleList",{}).then(function(t){1==t.code&&(e.tableData=t.data.roleList,e.allMenuArr.push(t.data.jurList),e.menuData=[],e.getTree(t.data.jurList,e.menuData))}).catch(function(t){console.log(t)})},getJurisdition:function(t){var e=this;new l.a(function(i,n){e.$fetch(e.url+"getJurisditionList",{nowId:t.id}).then(function(t){if(t.data){var n=t.data[0].menu_id.split(",");i(n.map(Number))}else e.menuData=[],e.jurTitle="暂无权限，请配置权限"}).catch(function(t){console.log(t)})}).then(function(i){e.$fetch(e.url+"getJurisditionTree",{idArr:a()(i)}).then(function(i){1==i.code?(e.jurTitle=t.role_name+"权限",e.menuData=[],e.getTree(i.data,e.menuData)):alert(i.msg)}).catch(function(t){console.log(t)})})},getTree:function(t,e){for(var i in t)if(0==t[i].fid){var n={id:t[i].id,label:t[i].label,children:[]};for(var a in t)t[a].fid==t[i].id&&n.children.push({id:t[a].id,label:t[a].label});e.push(n)}},getNowJurisdition:function(t){var e=this;this.editJurDialog=!0;var i=this.allMenuArr[0],n=[];this.nowRoleId=t.id,this.$fetch(this.url+"getJurisditionList",{nowId:t.id}).then(function(t){if(t.data){var a=t.data[0].menu_id.split(",").map(Number),r=[],l=[];for(var o in i)r.push({key:i[o].id,label:i[o].label});for(var s=0;s<i.length;s++)for(var c=0;c<a.length;c++)i[s].id==a[c]&&l.push(a[c]);e.editJurData=r,e.editJurVal=l}else{for(var u in i)n.push({key:i[u].id,label:i[u].label});e.editJurData=n,e.$message({showClose:!0,message:t.msg,type:"error"})}}).catch(function(t){console.log(t)})},handleClose:function(t){var e=this;this.$confirm("是否保留更改？").then(function(i){t(),e.editJurisdition()}).catch(function(e){t()})},editJurisdition:function(){var t=this;console.log(this.nowRoleId);var e=this.editJurVal;this.$fetch(this.url+"editJurisdition",{nowJurArr:a()(e),nowRoleId:this.nowRoleId}).then(function(e){var i="";i=1==e.code?"success":"error",t.$message({showClose:!0,message:e.msg,type:i}),t.editJurDialog=!1}).catch(function(t){console.log(t)})}}},s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"contanir"},[i("el-row",[i("h2",{staticStyle:{"text-align":"center"}},[t._v("权限管理")])]),t._v(" "),i("el-row",{attrs:{gutter:24}},[i("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"点击查看所有权限",placement:"top"}},[i("el-button",{attrs:{type:"primary",circle:"",icon:"el-icon-view"},on:{click:function(e){return t.getJurisditionList("权限列表")}}})],1)],1),t._v(" "),i("el-col",{staticStyle:{"text-align":"center"},attrs:{span:10}},[i("h4",[t._v("角色菜单")])]),t._v(" "),i("el-col",{staticStyle:{"text-align":"center"},attrs:{span:10}},[i("h4",[t._v(t._s(t.jurTitle))])])],1),t._v(" "),i("el-table",{staticStyle:{width:"50%",float:"left"},attrs:{data:t.tableData,"highlight-current-row":"",border:""}},[i("el-table-column",{attrs:{align:"center",prop:"id",label:"ID"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",prop:"role_name",label:"角色"}}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"权限配置"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"点击查看当前拥有权限",placement:"top"}},[i("el-button",{attrs:{icon:"el-icon-search",circle:""},on:{click:function(i){return t.getJurisdition(e.row)}}})],1),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"点击修改权限",placement:"top"}},["超级管理员"==e.row.role_name?i("el-button",{attrs:{type:"primary",disabled:"",icon:"el-icon-edit",circle:""},on:{click:function(i){return t.getNowJurisdition(e.row)}}}):i("el-button",{attrs:{type:"primary",icon:"el-icon-edit",circle:""},on:{click:function(i){return t.getNowJurisdition(e.row)}}})],1)]}}])})],1),t._v(" "),i("el-dialog",{attrs:{title:t.jurTitle,"destroy-on-close":"",visible:t.editJurDialog,width:"50%","before-close":t.handleClose},on:{"update:visible":function(e){t.editJurDialog=e}}},[[i("el-transfer",{attrs:{titles:t.transferTitle,data:t.editJurData},model:{value:t.editJurVal,callback:function(e){t.editJurVal=e},expression:"editJurVal"}})],t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.editJurDialog=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.editJurisdition}},[t._v("确 定")])],1)],2),t._v(" "),i("el-tree",{attrs:{data:t.menuData,props:t.defaultProps}})],1)},staticRenderFns:[]};var c=i("VU/8")(o,s,!1,function(t){i("C6mo")},"data-v-b21808a8",null);e.default=c.exports},C6mo:function(t,e){}});
//# sourceMappingURL=12.48723a2a32491f4fcfa6.js.map